<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Flow | Parachute Documentation</title>
    <meta name="description" content="How data flows through the Parachute system - streaming, sessions, sync, and storage">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="docs.css">
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">Parachute Computer</a>
            <div class="nav-links">
                <a href="/blog/">Blog</a>
                <a href="/architecture/" class="active">Docs</a>
                <a href="/roadmap/">Roadmap</a>
                <a href="https://github.com/OpenParachutePBC/parachute-computer" target="_blank">GitHub</a>
            </div>
        </nav>
    </header>

    <div class="docs-layout">
        <!-- Sidebar Navigation -->
        <aside class="docs-sidebar">
            <div class="sidebar-section">
                <h3>Overview</h3>
                <a href="index.html">Architecture</a>
                <a href="data-flow.html" class="active">Data Flow</a>
                <a href="integration.html">Integration</a>
            </div>
            <div class="sidebar-section">
                <h3>App (Flutter)</h3>
                <a href="app-overview.html">Overview</a>
                <a href="app-chat.html">Chat Feature</a>
                <a href="app-daily.html">Daily Feature</a>
                <a href="app-vault.html">Vault Feature</a>
                <a href="app-services.html">Services</a>
            </div>
            <div class="sidebar-section">
                <h3>Computer (Python)</h3>
                <a href="computer-overview.html">Overview</a>
                <a href="computer-api.html">API Routes</a>
                <a href="computer-orchestrator.html">Orchestrator</a>
                <a href="computer-agents.html">Modules &amp; Agents</a>
                <a href="computer-database.html">Database</a>
                <a href="computer-connectors.html">Bot Connectors</a>
            </div>
            <div class="sidebar-section">
                <h3>Reference</h3>
                <a href="issues.html">Issues & TODOs</a>
                <a href="file-manifest.html">File Manifest</a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="docs-content">
            <div class="breadcrumb">
                <a href="../index.html">Home</a> / <a href="../blog/">Blog</a>
                <a href="index.html">Docs</a> / <span>Data Flow</span>
            </div>

            <h1>Data Flow</h1>
            <p class="lead">How data moves through the Parachute system: from user input to AI response, from voice to transcript, from app to vault.</p>

            <!-- Chat Message Flow -->
            <section class="docs-section">
                <h2>Chat Message Flow</h2>
                <p>When a user sends a chat message, here's how it flows through the system:</p>

                <div class="architecture-visual">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. USER INPUT                                                            â”‚
â”‚                                                                           â”‚
â”‚     User types message in ChatScreen                                      â”‚
â”‚     â†“                                                                     â”‚
â”‚     ChatInput widget captures text + attachments                          â”‚
â”‚     â†“                                                                     â”‚
â”‚     chatMessagesNotifier.sendMessage()                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. APP STATE UPDATE                                                      â”‚
â”‚                                                                           â”‚
â”‚     Add optimistic user message to state                                  â”‚
â”‚     Add empty assistant message (for streaming)                           â”‚
â”‚     â†“                                                                     â”‚
â”‚     ChatService.sendMessage() â†’ HTTP POST /api/chat                       â”‚
â”‚     â†“                                                                     â”‚
â”‚     Open SSE connection for streaming response                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. SERVER RECEIVES REQUEST                                               â”‚
â”‚                                                                           â”‚
â”‚     POST /api/chat                                                        â”‚
â”‚     â”œâ”€â”€ Validate auth (API key or localhost)                              â”‚
â”‚     â”œâ”€â”€ Parse ChatRequest                                                 â”‚
â”‚     â””â”€â”€ Call orchestrator.run_streaming()                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ORCHESTRATOR PREPARES                                                 â”‚
â”‚                                                                           â”‚
â”‚     Load agent definition (or default vault-agent)                        â”‚
â”‚     Get or create session:                                                â”‚
â”‚     â”œâ”€â”€ New: Create pending placeholder, SDK will assign ID               â”‚
â”‚     â””â”€â”€ Resume: Load from DB, verify SDK session exists                   â”‚
â”‚     Build system prompt:                                                  â”‚
â”‚     â”œâ”€â”€ Agent system prompt                                               â”‚
â”‚     â”œâ”€â”€ Context files/folders                                             â”‚
â”‚     â””â”€â”€ Working directory context                                         â”‚
â”‚     Process attachments:                                                  â”‚
â”‚     â”œâ”€â”€ Save to vault/Chat/assets/{date}/                                 â”‚
â”‚     â””â”€â”€ Build attachment message parts                                    â”‚
â”‚     Check permissions:                                                    â”‚
â”‚     â”œâ”€â”€ Session grants (Read, Write, Bash, MCP)                           â”‚
â”‚     â””â”€â”€ Global deny patterns                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. CLAUDE SDK CALL                                                       â”‚
â”‚                                                                           â”‚
â”‚     claude_sdk.query_streaming():                                         â”‚
â”‚     â”œâ”€â”€ Override HOME to vault path (for .claude/ isolation)              â”‚
â”‚     â”œâ”€â”€ Build SDK query options (model, max_tokens, permissions)          â”‚
â”‚     â””â”€â”€ Call SDK with async generator                                     â”‚
â”‚                                                                           â”‚
â”‚     SDK connects to Claude AI:                                            â”‚
â”‚     â”œâ”€â”€ Sends conversation history                                        â”‚
â”‚     â”œâ”€â”€ Processes tool calls internally                                   â”‚
â”‚     â””â”€â”€ Streams response chunks                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. STREAMING RESPONSE                                                    â”‚
â”‚                                                                           â”‚
â”‚     SDK yields events â†’ Orchestrator yields SSE events                    â”‚
â”‚                                                                           â”‚
â”‚     Event types:                                                          â”‚
â”‚     â”œâ”€â”€ session: {id, title, created_at} â€” First event                    â”‚
â”‚     â”œâ”€â”€ text: {content} â€” Text chunk                                      â”‚
â”‚     â”œâ”€â”€ thinking: {content} â€” Thinking content                            â”‚
â”‚     â”œâ”€â”€ tool_use_start: {id, name, input} â€” Tool beginning                â”‚
â”‚     â”œâ”€â”€ tool_result: {tool_use_id, result} â€” Tool completed               â”‚
â”‚     â”œâ”€â”€ message_stop: {} â€” Message complete                               â”‚
â”‚     â””â”€â”€ error: {message} â€” Error occurred                                 â”‚
â”‚                                                                           â”‚
â”‚     Each event sent as:                                                   â”‚
â”‚     data: {"type": "text", "content": "Hello"}                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. APP RECEIVES & UPDATES                                                â”‚
â”‚                                                                           â”‚
â”‚     ChatService parses SSE events                                         â”‚
â”‚     â”œâ”€â”€ session: Save session ID to state                                 â”‚
â”‚     â”œâ”€â”€ text: Append to assistant message content                         â”‚
â”‚     â”œâ”€â”€ thinking: Add to thinking section                                 â”‚
â”‚     â”œâ”€â”€ tool_use_start: Add ToolCall to message                           â”‚
â”‚     â”œâ”€â”€ tool_result: Update ToolCall with result                          â”‚
â”‚     â””â”€â”€ message_stop: Mark message complete                               â”‚
â”‚                                                                           â”‚
â”‚     UI updates reactively via Riverpod:                                   â”‚
â”‚     MessageBubble renders streaming content                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. SESSION PERSISTENCE                                                   â”‚
â”‚                                                                           â”‚
â”‚     After message complete:                                               â”‚
â”‚                                                                           â”‚
â”‚     Server:                                                               â”‚
â”‚     â”œâ”€â”€ session_manager.update() â€” Update DB metadata                     â”‚
â”‚     â”œâ”€â”€ SDK writes to ~/.claude/projects/.../*.jsonl                      â”‚
â”‚     â””â”€â”€ Activity hook triggers (title + summary generation)               â”‚
â”‚                                                                           â”‚
â”‚     App:                                                                  â”‚
â”‚     â”œâ”€â”€ Update local session state                                        â”‚
â”‚     â””â”€â”€ Session available for resume                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </pre>
                </div>
            </section>

            <!-- Vault Structure -->
            <section class="docs-section" id="vault">
                <h2>Vault Structure</h2>
                <p>The vault is your local-first data store. All Parachute data lives in plain files at <code>~/Parachute</code>:</p>

                <div class="architecture-visual">
                    <pre>
~/Parachute/
â”œâ”€â”€ Daily/                          # Journal entries (local-first)
â”‚   â”œâ”€â”€ 2026-01-28.md              # Today's journal
â”‚   â”œâ”€â”€ 2026-01-27.md              # Yesterday's journal
â”‚   â”œâ”€â”€ assets/                     # Media files
â”‚   â”‚   â”œâ”€â”€ 2026-01-28/
â”‚   â”‚   â”‚   â”œâ”€â”€ audio-10-30-am.m4a
â”‚   â”‚   â”‚   â””â”€â”€ photo-10-45-am.jpg
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ reflection/                 # Reflection agent outputs
â”‚   â”‚   â””â”€â”€ 2026-01-28.md
â”‚   â”œâ”€â”€ content-scout/              # Content-scout outputs
â”‚   â”‚   â””â”€â”€ 2026-01-28.md
â”‚   â”œâ”€â”€ .agents/                    # Custom daily agents
â”‚   â”‚   â””â”€â”€ my-agent.md
â”‚   â””â”€â”€ .agents/                    # Daily agent configs
â”‚       â””â”€â”€ content-scout.md
â”‚
â”œâ”€â”€ Chat/                           # Chat sessions (server-managed)
â”‚   â”œâ”€â”€ sessions.db                 # SQLite metadata
â”‚   â”œâ”€â”€ assets/                     # Chat attachments
â”‚   â”‚   â””â”€â”€ 2026-01-28/
â”‚   â”‚       â””â”€â”€ uploaded-file.pdf
â”‚   â””â”€â”€ contexts/                   # Saved context configurations
â”‚       â””â”€â”€ my-project.json
â”‚
â”œâ”€â”€ .claude/                        # Claude SDK data
â”‚   â”œâ”€â”€ projects/                   # Session transcripts (JSONL)
â”‚   â”‚   â””â”€â”€ {project-hash}/
â”‚   â”‚       â””â”€â”€ {session-id}.jsonl
â”‚   â””â”€â”€ settings.json               # SDK settings
â”‚
â”œâ”€â”€ .parachute/                     # Parachute config
â”‚   â”œâ”€â”€ server-config.json          # Auth settings, API keys
â”‚   â”œâ”€â”€ agents/                     # Global agent definitions
â”‚   â”‚   â””â”€â”€ vault-agent.md
â”‚   â””â”€â”€ skills/                     # Skill plugins
â”‚       â””â”€â”€ my-skill.md
â”‚
â””â”€â”€ ... (user files)                # Rest of your vault
                    </pre>
                </div>

                <div class="callout callout-info">
                    <strong>Pointer Architecture:</strong> The SQLite database (<code>sessions.db</code>) stores only metadata. Actual message transcripts live in SDK JSONL files. This makes the database a pointer layer, not the source of truth for message content.
                </div>
            </section>

            <!-- Para-ID System -->
            <section class="docs-section" id="para-id">
                <h2>Para-ID System</h2>
                <p>Portable identifiers for cross-device sync. Every journal entry gets a unique ID that follows it everywhere.</p>

                <div class="code-block">
                    <div class="code-header">Journal Entry Format</div>
                    <pre><code># para:abc123def456 10:30 AM

Walked to the coffee shop this morning. Had a great idea about
the project architecture...

## Images
![Morning sky](../assets/2026-01-28/photo-10-30-am.jpg)

## Audio
- Duration: 2:30
- Path: ../assets/2026-01-28/audio-10-30-am.m4a</code></pre>
                </div>

                <h3>Format Specification</h3>
                <ul>
                    <li><strong>Pattern:</strong> <code>para:{12-char-alphanumeric}</code></li>
                    <li><strong>Example:</strong> <code>para:abc123def456</code></li>
                    <li><strong>Location:</strong> H1 header of entry section</li>
                    <li><strong>Generated:</strong> On entry creation, never changes</li>
                    <li><strong>Scope:</strong> Unique across all modules (Daily, Chat, etc.)</li>
                </ul>

                <h3>Sync Flow</h3>
                <div class="architecture-visual">
                    <pre>
Device A                           Server                          Device B
   â”‚                                 â”‚                                 â”‚
   â”‚  Create entry                   â”‚                                 â”‚
   â”‚  para:abc123def456              â”‚                                 â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚  â”€â”€â”€â”€â”€â”€ Sync (push) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                 â”‚
   â”‚  Hash: sha256:123...            â”‚                                 â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚â—€â”€â”€â”€â”€â”€â”€ Sync (pull) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                                 â”‚  Request manifest               â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚â”€â”€â”€â”€â”€â”€â”€ Manifest â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚                                 â”‚  para:abc123def456              â”‚
   â”‚                                 â”‚  Hash: sha256:123...            â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚â—€â”€â”€â”€â”€â”€â”€ Fetch entry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚â”€â”€â”€â”€â”€â”€â”€ Entry content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚                                 â”‚  # para:abc123def456 10:30 AM  â”‚
   â”‚                                 â”‚  ...                            â”‚
   â”‚                                 â”‚                                 â”‚
   â”‚                                 â”‚                         Entry saved
   â”‚                                 â”‚                         Same para:ID
                    </pre>
                </div>
            </section>

            <!-- Voice Transcription Flow -->
            <section class="docs-section">
                <h2>Voice Transcription Flow</h2>
                <p>Local-first transcription using Sherpa-ONNX with streaming display:</p>

                <div class="architecture-visual">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. AUDIO CAPTURE                                                         â”‚
â”‚                                                                           â”‚
â”‚     Microphone â†’ record package â†’ PCM audio stream                        â”‚
â”‚     â†“                                                                     â”‚
â”‚     Audio chunks (16kHz, 16-bit, mono)                                    â”‚
â”‚     â†“                                                                     â”‚
â”‚     StreamingVoiceService receives chunks                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. VOICE ACTIVITY DETECTION                                              â”‚
â”‚                                                                           â”‚
â”‚     SimpleVAD analyzes audio levels                                       â”‚
â”‚     â”œâ”€â”€ Below threshold: Silence                                          â”‚
â”‚     â””â”€â”€ Above threshold: Speech detected                                  â”‚
â”‚     â†“                                                                     â”‚
â”‚     SmartChunker groups speech into segments                              â”‚
â”‚     â”œâ”€â”€ Min segment: 1 second                                             â”‚
â”‚     â”œâ”€â”€ Max segment: 30 seconds                                           â”‚
â”‚     â””â”€â”€ Split on silence > 500ms                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. TRANSCRIPTION (Sherpa-ONNX)                                           â”‚
â”‚                                                                           â”‚
â”‚     Audio segment â†’ SherpaOnnxService                                     â”‚
â”‚     â”œâ”€â”€ Runs in isolate (background thread)                               â”‚
â”‚     â”œâ”€â”€ Uses Parakeet model (465MB)                                       â”‚
â”‚     â””â”€â”€ Returns: TranscriptionResult                                      â”‚
â”‚                                                                           â”‚
â”‚     LocalAgreement-2 algorithm:                                           â”‚
â”‚     â”œâ”€â”€ Re-transcribe every 2 seconds                                     â”‚
â”‚     â”œâ”€â”€ Compare consecutive transcriptions                                â”‚
â”‚     â”œâ”€â”€ Confirm text stable across 2+ iterations                          â”‚
â”‚     â””â”€â”€ Display: [confirmed] + [tentative] + [interim]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. STATE UPDATE                                                          â”‚
â”‚                                                                           â”‚
â”‚     StreamingTranscriptionState:                                          â”‚
â”‚     â”œâ”€â”€ confirmed: "I went to the store"     â† Stable, won't change       â”‚
â”‚     â”œâ”€â”€ tentative: "and bought some"         â† Likely stable              â”‚
â”‚     â””â”€â”€ interim: "coff"                      â† Still processing           â”‚
â”‚                                                                           â”‚
â”‚     UI shows: "I went to the store and bought some coffâ–Œ"                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. SAVE TO JOURNAL                                                       â”‚
â”‚                                                                           â”‚
â”‚     User stops recording â†’ Final transcription                            â”‚
â”‚     â†“                                                                     â”‚
â”‚     JournalService.saveEntry():                                           â”‚
â”‚     â”œâ”€â”€ Generate para:ID                                                  â”‚
â”‚     â”œâ”€â”€ Save audio to Daily/assets/{date}/                                â”‚
â”‚     â”œâ”€â”€ Write markdown entry with transcript                              â”‚
â”‚     â””â”€â”€ Update journal day file                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </pre>
                </div>
            </section>

            <!-- Session Lifecycle -->
            <section class="docs-section">
                <h2>Session Lifecycle</h2>

                <h3>New Session</h3>
                <ol>
                    <li>User sends first message (no session_id)</li>
                    <li>Orchestrator creates "pending" placeholder</li>
                    <li>SDK executes and generates session ID</li>
                    <li>SessionManager creates DB record with SDK session ID</li>
                    <li>SDK writes transcript to <code>~/.claude/projects/.../session.jsonl</code></li>
                    <li>Activity hook triggers title generation</li>
                </ol>

                <h3>Resume Session</h3>
                <ol>
                    <li>User opens existing session</li>
                    <li>App loads session from provider (cached or fetched)</li>
                    <li>User sends message with session_id</li>
                    <li>SessionManager looks up DB record</li>
                    <li>SDK resumes with existing session ID</li>
                    <li>Conversation continues from where it left off</li>
                </ol>

                <h3>Imported Session (Claude/ChatGPT)</h3>
                <ol>
                    <li>User uploads JSON export file</li>
                    <li>ImportService parses format (auto-detects source)</li>
                    <li>Converts messages to SDK JSONL format</li>
                    <li>Creates session in DB with source flag</li>
                    <li>Optionally enables "continuation" mode</li>
                    <li>User can continue conversation with full context</li>
                </ol>
            </section>

            <!-- Background Processing -->
            <section class="docs-section">
                <h2>Background Processing</h2>
                <p>Automated agents and hooks process content in the background:</p>

                <div class="architecture-visual">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ACTIVITY HOOK (Post-Session)                              â”‚
â”‚                                                                            â”‚
â”‚  Triggered: After each chat exchange completes                             â”‚
â”‚  Purpose: Generate/update title, summarize to daily chat log               â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Session         â”‚ â”€â”€â”€â–¶ â”‚  Summarizer      â”‚ â”€â”€â”€â–¶ â”‚  update_title()  â”‚ â”‚
â”‚  â”‚  completes       â”‚      â”‚  Agent           â”‚      â”‚  write_chat_log  â”‚ â”‚
â”‚  â”‚                  â”‚      â”‚  (one-shot)      â”‚      â”‚  track_metrics   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                            â”‚
â”‚  Output: Daily/chat-log/{date}.md                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DAILY AGENTS (Scheduled via APScheduler)                   â”‚
â”‚                                                                            â”‚
â”‚  Location: Daily/.agents/*.md                                              â”‚
â”‚  Schedule: Time from YAML frontmatter (default 3:00 UTC)                   â”‚
â”‚  Runner:   core/daily_agent.py + core/scheduler.py                         â”‚
â”‚                                                                            â”‚
â”‚  Example agent (content-scout.md):                                         â”‚
â”‚  ---                                                                       â”‚
â”‚  schedule: "8:00"                                                          â”‚
â”‚  schedule_enabled: true                                                    â”‚
â”‚  tools: [read_journal, web_search]                                         â”‚
â”‚  ---                                                                       â”‚
â”‚  Find relevant news and articles based on journal interests...             â”‚
â”‚                                                                            â”‚
â”‚  Scheduler discovers agents â†’ Runs at scheduled times â†’ Writes outputs     â”‚
â”‚                                                                            â”‚
â”‚  State: Daily/.{agent-name}/state.json (tracks last run date)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </pre>
                </div>
            </section>

            <!-- Streaming Protocol -->
            <section class="docs-section">
                <h2>Streaming Protocol</h2>
                <p>SSE (Server-Sent Events) for real-time responses:</p>

                <div class="code-block">
                    <div class="code-header">SSE Event Stream Example</div>
                    <pre><code># Connection opened to POST /api/chat

data: {"type": "session", "id": "sess_abc123", "title": "New Chat"}

data: {"type": "prompt_metadata", "model": "claude-sonnet-4", "context_files": 2}

data: {"type": "text", "content": "I'll help you "}

data: {"type": "text", "content": "with that. Let me "}

data: {"type": "tool_use_start", "id": "tool_1", "name": "Read", "input": {"file_path": "/src/main.py"}}

data: {"type": "tool_result", "tool_use_id": "tool_1", "result": "# Main entry point..."}

data: {"type": "text", "content": "I can see the main file. "}

data: {"type": "thinking", "content": "The user wants to understand the architecture..."}

data: {"type": "text", "content": "Here's what I found:"}

data: {"type": "message_stop"}

# Connection closed</code></pre>
                </div>

                <h3>Event Types</h3>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>When</th>
                            <th>Content</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>session</code></td>
                            <td>First event</td>
                            <td>Session ID, title, created_at</td>
                        </tr>
                        <tr>
                            <td><code>prompt_metadata</code></td>
                            <td>After session</td>
                            <td>Model, context files count</td>
                        </tr>
                        <tr>
                            <td><code>text</code></td>
                            <td>During response</td>
                            <td>Text content chunk</td>
                        </tr>
                        <tr>
                            <td><code>thinking</code></td>
                            <td>During response</td>
                            <td>Thinking/reasoning content</td>
                        </tr>
                        <tr>
                            <td><code>tool_use_start</code></td>
                            <td>Tool beginning</td>
                            <td>Tool ID, name, input</td>
                        </tr>
                        <tr>
                            <td><code>tool_result</code></td>
                            <td>Tool completed</td>
                            <td>Tool ID, result/error</td>
                        </tr>
                        <tr>
                            <td><code>message_stop</code></td>
                            <td>Response complete</td>
                            <td>Empty (signals end)</td>
                        </tr>
                        <tr>
                            <td><code>error</code></td>
                            <td>On error</td>
                            <td>Error message</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Navigation -->
            <section class="docs-section">
                <h2>Next Steps</h2>
                <div class="nav-cards">
                    <a href="integration.html" class="nav-card">
                        <h3>ğŸ”— Integration</h3>
                        <p>How app and Computer server connect: API contracts, authentication, and sync.</p>
                    </a>
                    <a href="computer-orchestrator.html" class="nav-card">
                        <h3>ğŸ­ Orchestrator</h3>
                        <p>Deep dive into the server's central agent controller.</p>
                    </a>
                </div>
            </section>
        </main>
    </div>

    <footer>
        <p>&copy; 2026 Open Parachute, PBC. A Colorado Public Benefit Corporation.</p>
        <p><a href="/blog/">Blog</a> &middot; <a href="/architecture/">Docs</a> &middot; <a href="/roadmap/">Roadmap</a> &middot; <a href="https://github.com/OpenParachutePBC/parachute-computer" target="_blank">GitHub</a></p>
    </footer>
</body>
</html>
